{{/* Hugo Blox: Skills Block */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}

{{/* Get user data */}}
{{ $author := "" }}
{{ with $block.content.username }}
  {{ $author = . }}
{{ else }}
  {{ $author = "admin" }}
{{ end }}

{{ $person_page_path := (printf "/authors/%s" $author) }}
{{ $person_page := site.GetPage $person_page_path }}
{{ if not $person_page }}
  {{ errorf "Could not find an author page at %s. Please check the value of username in your Skills block and create an associated author page if one does not already exist." $person_page_path }}
{{end}}
{{ $skills := $person_page.Params.skills }}

<div class="row justify-content-center">
  <div class="col-12">
    {{ with $block.content.text }}
      <div class="col-md-12 text-center mb-3">
        {{ . | emojify | $page.RenderString }}
      </div>
    {{ end }}

    <div class="row">
      {{ range $skills }}
        <div class="col-12 col-sm-6 mb-4">
          <div class="skill-group-title mb-3">
            {{ .name | markdownify | emojify }}
            {{ with .description }}<p class="mt-1">{{ . | markdownify | emojify }}</p>{{ end }}
          </div>
          
          {{ range .items }}
            {{ $pack := or .icon_pack "fas" }}
            {{ $pack_prefix := $pack }}
            {{ if in (slice "fab" "fas" "far" "fal") $pack }}
              {{ $pack_prefix = "fa" }}
            {{ end }}
            
            <div class="skills-content mb-2">
              {{ with .icon }}
                <span class="skills-icon me-2">
                  <i class="{{ $pack }} {{ $pack_prefix }}-{{ . }}"></i>
                </span>
              {{ end }}

              <span class="skills-name">
                {{ if .link }}
                  <a href="{{ .link }}" target="_blank" rel="noopener">
                    {{ .name | markdownify | emojify }}
                  </a>
                {{ else }}
                  {{ .name | markdownify | emojify }}
                {{ end }}
                {{ with .description }}
                  <p class="skills-description text-muted small mt-1">{{ . | markdownify | emojify }}</p>
                {{ end }}
              </span>

              {{ if .percent }}
                <div class="skills-wrapper mt-2">
                  <div class="skills-percent" style="width: {{ .percent }}%; background-color: #3f51b5;"></div>
                </div>
              {{ end }}
            </div>
          {{ end }}
        </div>
      {{ end }}
    </div>
  </div>
</div>

<style>
.skills-content {
  margin-bottom: 1rem;
}

.skills-icon {
  display: inline-block;
  width: 1.5em;
  text-align: center;
}

.skills-wrapper {
  background-color: #f5f5f5;
  border-radius: 4px;
  height: 6px;
  overflow: hidden;
}

.skills-percent {
  height: 100%;
  transition: width 0.6s ease;
}

.skills-content a {
  text-decoration: none;
  color: inherit;
  transition: color 0.3s ease;
}

.skills-content a:hover {
  color: #2962ff;
  text-decoration: underline;
}

.skill-group-title {
  font-weight: bold;
  font-size: 1.1em;
  color: #333;
}
</style>